{"version":3,"sources":["utils/utils.ts","Game/Config/Config.tsx","Game/Config/grid.ts","Game/State/shuffling.ts","Game/State/state.ts","Game/State/context.tsx","Game/components/Slot/Slot.styled.tsx","Game/components/Slot/Slot.tsx","utils/ids.ts","Game/components/Grid/Grid.styled.tsx","Game/components/Grid/Grid.tsx","Game/components/Piece/Piece.styled.tsx","Game/components/Piece/Piece.tsx","Game/components/Piece/useRenderPiece.tsx","Game/components/Piece/drawClipPath.ts","Game/components/Piece/StaticPiece.tsx","Game/components/Piece/DragPiece.tsx","Game/components/ReferenceImage/ReferenceImage.styled.tsx","Game/components/ReferenceImage/ReferenceImage.tsx","utils/element-size.ts","Game/components/Stage/Stage.styled.tsx","Game/components/Stage/Stage.tsx","Game/Game.tsx","Game/GameWrapper.tsx","utils/image-loader.ts","StartScreen.tsx","images/kitty.jpg","App.tsx","index.tsx"],"names":["times","n","cb","results","Array","i","Context","createContext","ConfigProvider","img","difficulty","otherProps","useState","imgWidth","width","imgHeight","height","setImageSize","value","useMemo","ratio","pieceSize","Math","min","numRows","round","numCols","getGridDimensions","pieceWidth","pieceHeight","pieceWidthSrc","pieceHeightSrc","margin","marginSrc","Provider","useConfig","instance","useContext","Error","isInRect","rect","top","left","right","bottom","movePieceToStage","state","pieceId","slots","Object","entries","reduce","acc","key","stage","filter","id","concat","pieces","markPiecesToBeShuffled","ids","shufflePieces","obstacles","map","piece","result","avoid","tries","obstacle","random","shufflePiece","getSlotPiece","slotId","getStagePieces","undefined","getPiecesToShuffle","isSolved","GameStateProvider","props","setState","stagePieces","piecesToShuffle","movePieceToSlot","targetSlotId","currentOccupant","slotsEntries","slotID","slotPieceID","fromEntries","pieceIds","markAllPiecesToBeShuffled","values","reset","y","x","createState","debug","process","useGameState","SlotWrapper","styled","div","display","outline","isHighlighted","Slot","coordsToId","pieceInSlot","useDrop","accept","collect","monitor","isOver","drop","item","dropRef","ref","StaticPiece","Table","table","position","GameGrid","children","GridRow","tr","GridCol","td","border","borderSpacing","GridWrapper","transform","Grid","PieceWrapper","maxWidth","maxHeight","Draglayer","zIndex","PieceCanvas","canvas","Piece","canvasRef","useRef","useEffect","current","ctx","getContext","clearRect","config","isTop","isBottom","isLeft","isRight","beginPath","save","translate","moveTo","lineTo","bezierCurveTo","strokeStyle","lineWidth","lineJoin","stroke","restore","drawClipPath","clip","drawImage","useRenderPiece","useDrag","type","options","dropEffect","isDragging","dragRef","preview","getEmptyImage","captureDraggingState","data-testid","style","cursor","opacity","getItemStyles","currentOffset","WebkitTransform","DragPiece","useDragLayer","getItem","itemType","getItemType","getSourceClientOffset","Image","show","hint","ReferenceImage","imgRef","element","size","setSize","observer","ResizeObserver","contentRect","observe","unobserve","useElementSize","src","StageWrapper","Stage","forwardRef","forwardedRef","didDrop","offset","useImperativeHandle","Game","showHelp","stageRef","gridRef","length","getBoundingClientRect","toJSON","color","toString","GameWrapper","imgSrc","error","isLoading","addEventListener","message","useImageLoader","DndProvider","backend","HTML5Backend","GameStateStart","onStart","className","onClick","displayName","App","isStarted","setStarted","console","log","version","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.79e9d083.chunk.js","sourcesContent":["export function times<Result>(n: number, cb: (i: number) => Result) {\n  const results: Result[] = new Array(n)\n  for (let i = 0; i < n; i += 1) {\n    results[i] = cb(i)\n  }\n  return results\n}\n","import {\n  createContext,\n  useContext,\n  useMemo,\n  useState,\n  PropsWithChildren,\n} from 'react'\nimport { getGridDimensions } from './grid'\n\ntype Props = {\n  img: HTMLImageElement\n  difficulty: number\n}\n\ntype ConfigContext = {\n  numCols: number\n  numRows: number\n  imgWidth: number\n  imgHeight: number\n  pieceWidth: number\n  pieceHeight: number\n  pieceWidthSrc: number\n  pieceHeightSrc: number\n  margin: number\n  marginSrc: number\n  setImageSize: (size: { width: number; height: number }) => void\n} & Props\n\nconst Context = createContext<ConfigContext | null>(null)\n\nexport function ConfigProvider({\n  img,\n  difficulty = 2,\n  ...otherProps\n}: PropsWithChildren<Props>) {\n  const [{ width: imgWidth, height: imgHeight }, setImageSize] = useState<{\n    width: number\n    height: number\n  }>(img)\n\n  const value = useMemo(() => {\n    const { numRows, numCols } = getGridDimensions(\n      imgWidth,\n      imgHeight,\n      difficulty,\n    )\n\n    const pieceWidth = imgWidth / numCols\n    const pieceHeight = imgHeight / numRows\n\n    const pieceWidthSrc = img.width / numCols\n    const pieceHeightSrc = img.height / numRows\n\n    const margin = Math.min(pieceWidth, pieceHeight) * 0.3\n    const marginSrc = Math.min(pieceWidthSrc, pieceHeightSrc) * 0.3\n\n    return {\n      img,\n      difficulty,\n      numRows,\n      numCols,\n      imgWidth,\n      imgHeight,\n      pieceWidth,\n      pieceHeight,\n      pieceWidthSrc,\n      pieceHeightSrc,\n      margin,\n      marginSrc,\n      setImageSize,\n    }\n  }, [img, imgWidth, imgHeight, difficulty])\n\n  return <Context.Provider value={value} {...otherProps} />\n}\n\nexport function useConfig(): ConfigContext {\n  const instance = useContext<ConfigContext | null>(Context)\n  if (!instance) {\n    throw new Error('`useConfig` must be called within `ConfigProvider`')\n  }\n  return instance\n}\n","type GridDimensions = {\n  numRows: number\n  numCols: number\n}\n\nexport function getGridDimensions(\n  width: number,\n  height: number,\n  ratio: number,\n): GridDimensions {\n  const pieceSize = Math.min(width, height) / ratio\n  return {\n    numRows: height ? Math.round(height / pieceSize) : 0,\n    numCols: width ? Math.round(width / pieceSize) : 0,\n  }\n}\n","export type Rect = {\n  top: number\n  bottom: number\n  left: number\n  right: number\n}\n\ntype Coords = {\n  top: number\n  left: number\n}\n\ntype ShuffleOptions = {\n  stage: Rect\n  avoid?: Rect[]\n  pieceWidth?: number\n  pieceHeight?: number\n}\n\nexport function shufflePiece({\n  stage,\n  avoid = [],\n  pieceWidth = 0,\n  pieceHeight = 0,\n}: ShuffleOptions): Coords {\n  let tries = 0\n  let result: Coords\n  const [obstacle] = avoid\n  do {\n    if (tries++ > 500) {\n      throw new Error('timeout!')\n    }\n    result = {\n      top: stage.top + Math.random() * (stage.bottom - stage.top - pieceHeight),\n      left:\n        stage.left + Math.random() * (stage.right - stage.left - pieceWidth),\n    }\n  } while (obstacle && isInRect(result, obstacle, pieceWidth, pieceHeight))\n  return result\n}\n\nexport function isInRect(\n  { top, left }: Coords,\n  rect: Rect,\n  pieceWidth: number,\n  pieceHeight: number,\n): boolean {\n  return (\n    left < rect.right &&\n    left + pieceWidth > rect.left &&\n    top + pieceHeight > rect.top &&\n    top < rect.bottom\n  )\n}\n","import { shufflePiece, Rect } from './shuffling'\n\nexport type ID = string\n\nexport interface IPiece {\n  id: ID\n  x: number\n  y: number\n  left?: number\n  top?: number\n}\n\nexport interface IGameState {\n  slots: Record<ID, ID>\n  stage: Array<ID>\n  pieces: Record<ID, IPiece>\n}\n\nexport function createState(numRows: number, numCols: number): IGameState {\n  const pieces: Record<ID, IPiece> = {}\n  const slots: Record<ID, ID> = {}\n\n  for (let y = 0; y < numRows; y += 1) {\n    for (let x = 0; x < numCols; x += 1) {\n      const id = `${x}-${y}`\n      pieces[id] = {\n        id,\n        x,\n        y,\n        left: 0,\n        top: 0,\n      }\n      slots[id] = id\n    }\n  }\n\n  return {\n    slots,\n    stage: [],\n    pieces,\n  }\n}\n\nexport function movePieceToStage(\n  state: IGameState,\n  pieceId: ID,\n  top?: number,\n  left?: number,\n): IGameState {\n  const slots = Object.entries(state.slots).reduce(\n    (acc, [key, value]) => ({\n      ...acc,\n      [key]: value === pieceId ? null : value,\n    }),\n    {},\n  )\n\n  const stage = state.stage.filter(id => id !== pieceId).concat(pieceId)\n\n  const pieces = {\n    ...state.pieces,\n    [pieceId]: {\n      ...state.pieces[pieceId],\n      top,\n      left,\n    },\n  }\n\n  return { ...state, slots, stage, pieces }\n}\n\nexport function movePieceToSlot(\n  state: IGameState,\n  pieceId: ID,\n  targetSlotId: ID,\n): IGameState {\n  const currentOccupant = getSlotPiece(state, targetSlotId)\n\n  if (currentOccupant) {\n    state = markPiecesToBeShuffled(state, [currentOccupant.id])\n  }\n\n  const slotsEntries = Object.entries(state.slots).map(\n    ([slotID, slotPieceID]) => {\n      if (slotPieceID === pieceId) {\n        return [slotID, null]\n      } else if (slotID === targetSlotId) {\n        return [slotID, pieceId]\n      } else {\n        return [slotID, slotPieceID]\n      }\n    },\n  )\n\n  const pieces = {\n    ...state.pieces,\n    [pieceId]: {\n      ...state.pieces[pieceId],\n      top: 0,\n      left: 0,\n    },\n  }\n\n  return {\n    ...state,\n    pieces,\n    slots: Object.fromEntries(slotsEntries),\n    stage: state.stage.filter(id => id !== pieceId),\n  }\n}\n\nexport function markPiecesToBeShuffled(\n  state: IGameState,\n  ids: ID[],\n): IGameState {\n  for (const id of ids) {\n    state = movePieceToStage(state, id)\n  }\n  return state\n}\n\nexport function markAllPiecesToBeShuffled(state: IGameState): IGameState {\n  const ids = Object.values(state.slots)\n  return markPiecesToBeShuffled(state, ids)\n}\n\nexport function shufflePieces(\n  state: IGameState,\n  stage: Rect,\n  obstacles?: Rect[],\n  pieceWidth?: number,\n  pieceHeight?: number,\n): IGameState {\n  const pieces: Record<ID, IPiece> = {\n    ...state.pieces,\n    ...state.stage\n      .map(id => state.pieces[id])\n      .reduce((acc, piece) => {\n        acc[piece.id] = {\n          ...piece,\n          ...shufflePiece({ stage, avoid: obstacles, pieceWidth, pieceHeight }),\n        }\n        return acc\n      }, {} as Record<ID, IPiece>),\n  }\n\n  return {\n    ...state,\n    pieces,\n  }\n}\n\nexport function getSlotPiece(state: IGameState, slotId: ID): IPiece | null {\n  const pieceId = state.slots[slotId]\n  return pieceId ? state.pieces[pieceId] : null\n}\n\nexport function getStagePieces(state: IGameState): Array<IPiece> {\n  return state.stage\n    .map(id => state.pieces[id])\n    .filter(({ left, top }) => left !== undefined && top !== undefined)\n}\n\nexport function getPiecesToShuffle(state: IGameState): Array<IPiece> {\n  return state.stage\n    .map(id => state.pieces[id])\n    .filter(({ left, top }) => left === undefined && top === undefined)\n}\n\nexport function isSolved(state: IGameState): boolean {\n  for (const [slotId, pieceId] of Object.entries(state.slots)) {\n    if (!pieceId || pieceId !== slotId) {\n      return false\n    }\n  }\n  return true\n}\n","import {\n  useState,\n  createContext,\n  PropsWithChildren,\n  useContext,\n  useMemo,\n} from 'react'\n\nimport { Rect } from './shuffling'\n\nimport {\n  createState,\n  movePieceToStage,\n  movePieceToSlot,\n  markPiecesToBeShuffled,\n  markAllPiecesToBeShuffled,\n  shufflePieces,\n  getSlotPiece,\n  getStagePieces,\n  getPiecesToShuffle,\n  isSolved,\n  ID,\n  IGameState,\n  IPiece,\n} from './state'\n\ntype GameStateContext = {\n  isSolved: boolean\n  stagePieces: IPiece[]\n  piecesToShuffle: IPiece[]\n  getSlotPiece: (slotID: ID) => IPiece | null\n  movePieceToStage: (pieceId: ID, top: number, left: number) => void\n  movePieceToSlot: (pieceId: ID, slotId: ID) => void\n  markPiecesToBeShuffled: (pieceIds: ID[]) => void\n  markAllPiecesToBeShuffled: () => void\n  reset: (numRows: number, numCols: number) => void\n  shufflePieces: (\n    stage: Rect,\n    obstacles: Rect[],\n    pieceWidth: number,\n    pieceHeight: number,\n  ) => void\n  debug: () => void\n}\n\nconst Context = createContext<GameStateContext | null>(null)\n\nexport function GameStateProvider(props: PropsWithChildren<unknown>) {\n  const [state, setState] = useState<IGameState>({\n    slots: {},\n    stage: [],\n    pieces: {},\n  })\n\n  const value = useMemo(\n    () => ({\n      isSolved: isSolved(state),\n      stagePieces: getStagePieces(state),\n      piecesToShuffle: getPiecesToShuffle(state),\n      getSlotPiece: (slotId: ID) => getSlotPiece(state, slotId),\n      movePieceToStage: (pieceId: ID, top: number, left: number) =>\n        setState(state => movePieceToStage(state, pieceId, top, left)),\n      movePieceToSlot: (pieceId: ID, slotId: ID) =>\n        setState(state => movePieceToSlot(state, pieceId, slotId)),\n      markPiecesToBeShuffled: (pieceIds: ID[]) =>\n        setState(state => markPiecesToBeShuffled(state, pieceIds)),\n      markAllPiecesToBeShuffled: () =>\n        setState(state => markAllPiecesToBeShuffled(state)),\n      shufflePieces: (\n        stage: Rect,\n        obstacles: Rect[],\n        pieceWidth: number,\n        pieceHeight: number,\n      ) =>\n        setState(state =>\n          shufflePieces(state, stage, obstacles, pieceWidth, pieceHeight),\n        ),\n      reset: (numRows: number, numCols: number) =>\n        setState(createState(numRows, numCols)),\n      debug: debug(state),\n    }),\n    [state],\n  )\n  return <Context.Provider value={value} {...props} />\n}\n\nexport function useGameState(): GameStateContext {\n  const instance = useContext<GameStateContext | null>(Context)\n  if (!instance) {\n    throw new Error('`useGameState` must be called within `GameStateProvider`')\n  }\n  return instance\n}\n\nfunction debug(state: IGameState) {\n  return () => {\n    if (process.env.NODE_ENV !== 'production') {\n      console.log({ state })\n    }\n  }\n}\n","import styled from 'styled-components'\n\nexport const SlotWrapper = styled.div((props: { isHighlighted: boolean }) => ({\n  display: 'block',\n  height: '100%',\n  outline: props.isHighlighted ? '3px solid rebeccapurple' : 'none',\n}))\n","import { PropsWithChildren } from 'react'\n\nimport { useDrop } from 'react-dnd'\nimport { StaticPiece } from '..'\nimport { coordsToId } from '../../../utils'\nimport { useGameState } from '../../State'\nimport { SlotWrapper } from './Slot.styled'\n\ntype SlotProps = {\n  x: number\n  y: number\n}\n\nexport function Slot({ x, y }: PropsWithChildren<SlotProps>) {\n  const { getSlotPiece, movePieceToSlot } = useGameState()\n\n  const slotId = coordsToId(x, y)\n  const pieceInSlot = getSlotPiece(slotId)\n  const onDropPiece = (pieceId: string) => movePieceToSlot(pieceId, slotId)\n\n  const [{ isOver }, dropRef] = useDrop(() => ({\n    accept: 'piece',\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n    }),\n    drop: (item: { id: string }) => {\n      onDropPiece(item.id)\n    },\n  }))\n\n  return (\n    <SlotWrapper ref={dropRef} isHighlighted={isOver}>\n      {pieceInSlot ? <StaticPiece piece={pieceInSlot} /> : null}\n    </SlotWrapper>\n  )\n}\n","export function coordsToId(x: number, y: number): string {\n  return `${x}-${y}`\n}\n","import { ComponentProps, PropsWithChildren } from 'react'\nimport styled from 'styled-components'\n\nconst Table = styled.table({\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  width: '100%',\n  height: '100%',\n})\n\nexport const GameGrid = (\n  props: PropsWithChildren<ComponentProps<typeof Table>>,\n) => (\n  <Table {...props}>\n    <tbody>{props.children}</tbody>\n  </Table>\n)\n\nexport const GridRow = styled.tr({})\n\nexport const GridCol = styled.td({\n  position: 'relative',\n  border: '1px solid rgba(0, 0, 0, 0.4)',\n  borderSpacing: 0,\n})\n\nexport const GridWrapper = styled.div({\n  display: 'inline-block',\n  position: 'relative',\n  top: '50%',\n  left: '50%',\n  transform: 'translate(-50%, -50%)',\n})\n","import { times } from '../../../utils'\nimport { useConfig } from '../../Config'\nimport { Slot } from '../Slot'\nimport { GameGrid, GridCol, GridRow } from './Grid.styled'\n\nexport function Grid() {\n  const { numCols, numRows } = useConfig()\n  return (\n    <GameGrid>\n      {times(numRows, y => (\n        <GridRow key={y}>\n          {times(numCols, x => (\n            <GridCol key={x}>\n              <Slot x={x} y={y} />\n            </GridCol>\n          ))}\n        </GridRow>\n      ))}\n    </GameGrid>\n  )\n}\n","import { PropsWithChildren } from 'react'\nimport styled from 'styled-components'\n\nexport const PieceWrapper = styled.div({\n  position: 'absolute',\n  maxWidth: '100%',\n  maxHeight: '100%',\n  ':hover': {\n    'z-index': '1',\n  },\n})\n\nexport const Draglayer = styled.div({\n  position: 'fixed',\n  'pointer-events': 'none',\n  zIndex: 100,\n  left: 0,\n  top: 0,\n  width: '100%',\n  height: '100%',\n})\n\nexport const PieceCanvas = styled.canvas(\n  ({ margin }: PropsWithChildren<{ margin: number }>) => ({\n    'pointer-events': 'none',\n    transform: `translate(${-margin}px, ${-margin}px)`,\n  }),\n)\n","import { useConfig } from '../../Config'\nimport { IPiece } from '../../State'\nimport { PieceCanvas } from './Piece.styled'\nimport { useRenderPiece } from './useRenderPiece'\n\ntype Props = {\n  piece: IPiece\n}\n\nexport function Piece({ piece: { x, y } }: Props) {\n  const { margin, pieceWidth, pieceHeight } = useConfig()\n\n  const canvasRef = useRenderPiece({ x, y })\n\n  return (\n    <PieceCanvas\n      ref={canvasRef}\n      width={pieceWidth + 2 * margin}\n      height={pieceHeight + 2 * margin}\n      margin={margin}\n    />\n  )\n}\n","import { useEffect, useRef } from 'react'\n\nimport { useConfig } from '../../Config'\nimport { IPiece } from '../../State'\nimport { drawClipPath } from './drawClipPath'\n\nexport function useRenderPiece({ x, y }: Pick<IPiece, 'x' | 'y'>) {\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n  const {\n    img,\n    pieceWidth,\n    pieceHeight,\n    marginSrc,\n    margin,\n    pieceWidthSrc,\n    pieceHeightSrc,\n    numCols,\n    numRows,\n  } = useConfig()\n\n  useEffect(() => {\n    const { current: canvas } = canvasRef\n    if (canvas) {\n      const ctx = canvas.getContext('2d')\n\n      if (ctx) {\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n        drawClipPath(ctx, {\n          margin,\n          pieceWidth,\n          pieceHeight,\n          x,\n          y,\n          numRows,\n          numCols,\n        })\n        ctx.save()\n        ctx.clip()\n\n        ctx.drawImage(\n          img,\n          x * pieceWidthSrc - marginSrc,\n          y * pieceHeightSrc - marginSrc,\n          pieceWidthSrc + 2 * marginSrc,\n          pieceHeightSrc + 2 * marginSrc,\n          0,\n          0,\n          pieceWidth + 2 * margin,\n          pieceHeight + 2 * margin,\n        )\n        ctx.restore()\n      }\n    }\n  }, [\n    x,\n    y,\n    img,\n    pieceWidth,\n    pieceHeight,\n    marginSrc,\n    margin,\n    pieceWidthSrc,\n    pieceHeightSrc,\n    numCols,\n    numRows,\n  ])\n\n  return canvasRef\n}\n","type ClipPathConfig = {\n  margin: number\n  pieceWidth: number\n  pieceHeight: number\n  x: number\n  y: number\n  numRows: number\n  numCols: number\n}\n\nexport function drawClipPath(\n  ctx: CanvasRenderingContext2D,\n  config: ClipPathConfig,\n) {\n  const { margin, pieceWidth, pieceHeight, x, y, numRows, numCols } = config\n  const isTop = y === 0\n  const isBottom = y === numRows - 1\n  const isLeft = x === 0\n  const isRight = x === numCols - 1\n\n  ctx.beginPath()\n  ctx.save()\n  ctx.translate(margin, margin)\n  ctx.moveTo(0, 0)\n\n  if (!isTop) {\n    ctx.lineTo(pieceWidth * 0.4, 0)\n    if (y % 2) {\n      ctx.bezierCurveTo(\n        pieceWidth * 0.5 - margin,\n        margin,\n        pieceWidth * 0.5 + margin,\n        margin,\n        pieceWidth * 0.6,\n        0,\n      )\n    } else {\n      ctx.bezierCurveTo(\n        pieceWidth * 0.5 - margin,\n        -margin,\n        pieceWidth * 0.5 + margin,\n        -margin,\n        pieceWidth * 0.6,\n        0,\n      )\n    }\n  }\n  ctx.lineTo(pieceWidth, 0)\n\n  if (!isRight) {\n    ctx.lineTo(pieceWidth, pieceHeight * 0.4)\n    if (x % 2) {\n      ctx.bezierCurveTo(\n        pieceWidth + margin,\n        pieceHeight * 0.5 - margin,\n        pieceWidth + margin,\n        pieceHeight * 0.5 + margin,\n        pieceWidth,\n        pieceHeight * 0.6,\n      )\n    } else {\n      ctx.bezierCurveTo(\n        pieceWidth - margin,\n        pieceHeight * 0.5 - margin,\n        pieceWidth - margin,\n        pieceHeight * 0.5 + margin,\n        pieceWidth,\n        pieceHeight * 0.6,\n      )\n    }\n  }\n  ctx.lineTo(pieceWidth, pieceHeight)\n\n  if (!isBottom) {\n    ctx.lineTo(pieceWidth * 0.6, pieceHeight)\n    if (y % 2) {\n      ctx.bezierCurveTo(\n        pieceWidth * 0.5 + margin,\n        pieceHeight - margin,\n        pieceWidth * 0.5 - margin,\n        pieceHeight - margin,\n        pieceWidth * 0.4,\n        pieceHeight,\n      )\n    } else {\n      ctx.bezierCurveTo(\n        pieceWidth * 0.5 + margin,\n        pieceHeight + margin,\n        pieceWidth * 0.5 - margin,\n        pieceHeight + margin,\n        pieceWidth * 0.4,\n        pieceHeight,\n      )\n    }\n  }\n  ctx.lineTo(0, pieceHeight)\n\n  if (!isLeft) {\n    ctx.lineTo(0, pieceHeight * 0.6)\n    if (x % 2) {\n      ctx.bezierCurveTo(\n        -margin,\n        pieceHeight * 0.5 + margin,\n        -margin,\n        pieceHeight * 0.5 - margin,\n        0,\n        pieceHeight * 0.4,\n      )\n    } else {\n      ctx.bezierCurveTo(\n        margin,\n        pieceHeight * 0.5 + margin,\n        margin,\n        pieceHeight * 0.5 - margin,\n        0,\n        pieceHeight * 0.4,\n      )\n    }\n  }\n  ctx.lineTo(0, 0)\n\n  ctx.strokeStyle = 'white'\n  ctx.lineWidth = 2\n  ctx.lineJoin = 'round'\n  ctx.stroke()\n\n  ctx.restore()\n}\n","import { useEffect } from 'react'\nimport { useDrag } from 'react-dnd'\nimport { getEmptyImage } from 'react-dnd-html5-backend'\n\nimport { IPiece } from '../../State'\nimport { Piece } from './Piece'\nimport { PieceWrapper } from './Piece.styled'\n\ntype Props = {\n  piece: IPiece\n}\n\nexport function StaticPiece({ piece }: Props) {\n  const { id, left, top } = piece\n\n  const [{ isDragging }, dragRef, preview] = useDrag({\n    type: 'piece',\n    item: piece,\n    options: {\n      dropEffect: 'move',\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  })\n\n  useEffect(() => {\n    preview(getEmptyImage(), {\n      captureDraggingState: true,\n    })\n  }, [preview])\n\n  return (\n    <PieceWrapper\n      ref={dragRef}\n      data-testid={`piece-${id}`}\n      style={{\n        top: `${top ?? 0}px`,\n        left: `${left ?? 0}px`,\n        cursor: 'grab',\n        opacity: isDragging ? 0 : 1,\n      }}\n    >\n      <Piece piece={piece} />\n    </PieceWrapper>\n  )\n}\n","import type { XYCoord } from 'react-dnd'\nimport { useDragLayer } from 'react-dnd'\n\nimport { Piece } from './Piece'\nimport { Draglayer, PieceWrapper } from './Piece.styled'\n\nfunction getItemStyles(currentOffset: XYCoord | null) {\n  if (!currentOffset) {\n    return {\n      display: 'none',\n    }\n  }\n\n  const { x, y } = currentOffset\n\n  const transform = `translate(${x}px, ${y}px)`\n  return {\n    transform,\n    WebkitTransform: transform,\n  }\n}\n\nexport function DragPiece() {\n  const { itemType, isDragging, item, currentOffset } = useDragLayer(\n    monitor => ({\n      item: monitor.getItem(),\n      itemType: monitor.getItemType(),\n      currentOffset: monitor.getSourceClientOffset(),\n      isDragging: monitor.isDragging(),\n    }),\n  )\n\n  if (!isDragging || itemType !== 'piece') {\n    return null\n  }\n\n  return (\n    <Draglayer>\n      <PieceWrapper\n        style={{\n          ...getItemStyles(currentOffset),\n          cursor: 'grabbing',\n        }}\n      >\n        <Piece piece={item} />\n      </PieceWrapper>\n    </Draglayer>\n  )\n}\n","import styled from 'styled-components'\n\nexport const Image = styled.img(\n  ({ show, hint }: { show: boolean; hint: boolean }) => ({\n    maxWidth: '100%',\n    maxHeight: '50vh',\n    opacity: show ? 1 : hint ? 0.2 : 0,\n  }),\n)\n","import { useRef, useEffect } from 'react'\nimport { useElementSize } from '../../../utils'\nimport { useConfig } from '../../Config'\nimport { Image } from './ReferenceImage.styled'\n\ntype ReferenceImageProps = {\n  show?: boolean\n  hint?: boolean\n}\n\nexport function ReferenceImage({\n  show = false,\n  hint = false,\n}: ReferenceImageProps) {\n  const imgRef = useRef<HTMLImageElement>(null)\n\n  const [width, height] = useElementSize(imgRef.current)\n\n  const { img, setImageSize } = useConfig()\n\n  useEffect(() => {\n    setImageSize({ width, height })\n  }, [width, height, setImageSize])\n\n  return <Image src={img.src} show={show} hint={hint} ref={imgRef} />\n}\n","import { useEffect, useState } from 'react'\nimport ResizeObserver from 'resize-observer-polyfill'\n\ntype Size = [number, number]\n\nexport function useElementSize(element: HTMLElement | null): Size {\n  const [size, setSize] = useState<Size>([0, 0])\n\n  useEffect(() => {\n    if (element) {\n      const observer = new ResizeObserver(\n        (entries: Array<ResizeObserverEntry>) => {\n          const { contentRect } = entries[0]\n          setSize([contentRect.width, contentRect.height])\n        },\n      )\n      observer.observe(element)\n      return () => observer.unobserve(element)\n    }\n  }, [element])\n\n  return size\n}\n","import styled from 'styled-components'\n\nexport const StageWrapper = styled.div`\n  boxShadow: ${({ isHighlighted }: { isHighlighted: boolean }) =>\n    isHighlighted ? '0px 0px 16px green inset' : 'none'},\n  margin-right: auto;\n  margin-left: auto;\n  padding: 15px 20px;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n`\n","import {\n  PropsWithChildren,\n  forwardRef,\n  useEffect,\n  useRef,\n  useImperativeHandle,\n} from 'react'\nimport { useDrop } from 'react-dnd'\nimport { StaticPiece } from '..'\nimport { useGameState } from '../../State'\nimport { StageWrapper } from './Stage.styled'\n\ntype Ref = HTMLDivElement | null\n\nexport const Stage = forwardRef<Ref, PropsWithChildren<unknown>>(\n  ({ children }, forwardedRef) => {\n    const ref = useRef<HTMLDivElement>(null)\n\n    const { movePieceToStage, stagePieces } = useGameState()\n\n    const [{ isOver }, dropRef] = useDrop(() => ({\n      accept: 'piece',\n      collect: monitor => ({\n        isOver: monitor.isOver(),\n      }),\n      drop: (item: { id: string }, monitor) => {\n        if (!monitor.didDrop()) {\n          const offset = monitor.getSourceClientOffset()\n          movePieceToStage(item.id, offset?.y ?? 0, offset?.x ?? 0)\n        }\n      },\n    }))\n\n    useEffect(() => {\n      dropRef(ref)\n    })\n\n    useImperativeHandle<Ref, Ref>(forwardedRef, () => ref.current)\n\n    return (\n      <StageWrapper isHighlighted={isOver} ref={ref}>\n        {children}\n        {stagePieces.map(piece => {\n          if (piece.top != null && piece.left != null) {\n            return <StaticPiece key={piece.id} piece={piece} />\n          }\n        })}\n      </StageWrapper>\n    )\n  },\n)\n\nStage.displayName = 'Stage'\n","import { useState, useEffect, useRef } from 'react'\n\nimport { useConfig } from './Config'\nimport { useGameState } from './State'\nimport {\n  DragPiece,\n  Grid,\n  GridWrapper,\n  ReferenceImage,\n  Stage,\n} from './components'\n\nexport function Game() {\n  const [showHelp] = useState<boolean>(false)\n  const stageRef = useRef<HTMLDivElement>(null)\n  const gridRef = useRef<HTMLDivElement>(null)\n\n  const { numRows, numCols, pieceWidth, pieceHeight } = useConfig()\n\n  const {\n    isSolved,\n    piecesToShuffle,\n    // markAllPiecesToBeShuffled,\n    shufflePieces,\n    reset,\n  } = useGameState()\n\n  useEffect(() => {\n    if (piecesToShuffle.length && stageRef.current) {\n      shufflePieces(\n        stageRef.current?.getBoundingClientRect().toJSON(),\n        [gridRef.current?.getBoundingClientRect().toJSON()],\n        pieceWidth,\n        pieceHeight,\n      )\n    }\n  }, [piecesToShuffle, shufflePieces, pieceWidth, pieceHeight])\n\n  useEffect(() => {\n    reset(numRows, numCols)\n  }, [numRows, numCols])\n\n  // useEffect(() => {\n  //   if (isSolved) {\n  //     markAllPiecesToBeShuffled()\n  //   }\n  // }, [isSolved])\n\n  return (\n    <>\n      <p style={{ color: 'white' }}>Solved: {isSolved.toString()}</p>\n      <Stage ref={stageRef}>\n        <GridWrapper ref={gridRef}>\n          <ReferenceImage hint={showHelp} />\n          <Grid />\n        </GridWrapper>\n        <DragPiece />\n      </Stage>\n    </>\n  )\n}\n","import { DndProvider } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\n\nimport { useImageLoader } from '../utils'\nimport { ConfigProvider } from './Config'\nimport { Game } from './Game'\nimport { GameStateProvider } from './State'\n\nexport type GameWrapperProps = {\n  imgSrc: string\n  difficulty: number\n}\n\nexport function GameWrapper({ imgSrc, difficulty }: GameWrapperProps) {\n  const { error, img, isLoading } = useImageLoader(imgSrc)\n\n  if (error) {\n    return (\n      <>\n        <h1>Error:</h1>\n        <h2>{error}</h2>\n      </>\n    )\n  }\n\n  if (isLoading) {\n    return <h1>loading</h1>\n  }\n\n  if (img) {\n    return (\n      <DndProvider backend={HTML5Backend}>\n        <ConfigProvider difficulty={difficulty} img={img}>\n          <GameStateProvider>\n            <Game />\n          </GameStateProvider>\n        </ConfigProvider>\n      </DndProvider>\n    )\n  }\n\n  return null\n}\n","import { useEffect, useState } from 'react'\n\nexport function useImageLoader(src: string) {\n  const [{ img, error, isLoading }, setState] = useState<{\n    img?: HTMLImageElement\n    error?: string\n    isLoading?: boolean\n  }>({})\n\n  useEffect(() => {\n    setState(state => ({ ...state, error: undefined, isLoading: true }))\n    const img = new Image()\n    img.addEventListener('load', () =>\n      setState({ img, error: undefined, isLoading: false }),\n    )\n    img.addEventListener('error', ({ message }) =>\n      setState(state => ({\n        ...state,\n        error: message || 'image could not be loaded :(',\n        isLoading: false,\n      })),\n    )\n    img.src = src\n  }, [src])\n\n  return {\n    error,\n    img,\n    isLoading,\n  }\n}\n","type GameStateStartProps = {\n  onStart: () => void\n}\n\n// The first game state. It just shows an introduction and a button that the player can click\n// when they're ready.\nexport default function GameStateStart({ onStart }: GameStateStartProps) {\n  return (\n    <>\n      <header className=\"page-header\">\n        <h1>\n          So Puzzled!! <br /> {'  '}\n          <small>\n            A little puzzle game for practice, written in React and jQueryUI\n          </small>\n        </h1>\n      </header>\n\n      <main className=\"jumbotron text-center\">\n        <h2>How to play:</h2>\n\n        <ol className=\"text-left inline-block\">\n          <li>\n            Click the <strong className=\"\">Start</strong> button\n          </li>\n          <li>Memorize the image</li>\n          <li>Piece the image back together</li>\n          <li>.. profit?</li>\n        </ol>\n\n        <p>\n          <button\n            type=\"button\"\n            className=\"btn btn-success btn-lg\"\n            onClick={onStart}\n          >\n            Start Puzzling\n          </button>\n        </p>\n      </main>\n    </>\n  )\n}\n","export default __webpack_public_path__ + \"static/media/kitty.9149cd00.jpg\";","import { useState } from 'react'\n\nimport Game from './Game'\nimport StartScreen from './StartScreen'\nimport img from './images/kitty.jpg'\n\nexport default function App() {\n  const [isStarted, setStarted] = useState<boolean>(true)\n\n  if (isStarted) {\n    return <Game imgSrc={img} difficulty={3} />\n  } else {\n    return <StartScreen onStart={() => setStarted(true)} />\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n// import reportWebVitals from './reportWebVitals';\n\nimport { version } from '../package.json'\n\nimport App from './App'\n\nconsole.log(`Version: ${version}`)\nconsole.log(`Build: ${process.env.NODE_ENV}`)\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('app'),\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals(console.log.bind(null, 'web vitals:'));\n"],"sourceRoot":""}