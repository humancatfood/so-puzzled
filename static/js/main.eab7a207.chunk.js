(this["webpackJsonpso-puzzled"]=this["webpackJsonpso-puzzled"]||[]).push([[0],{28:function(e){e.exports=JSON.parse('{"a":"2.2.0"}')},44:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),c=n(27),o=n.n(c),a=n(28),u=n(4),s=n(50),l=n(21),f=n(29);function d(e,t){for(var n=new Array(e),i=0;i<e;i+=1)n[i]=t(i);return n}var j=n(3);var b=n(36);var h=n(1),g=["img","difficulty"],O=Object(i.createContext)(null);function v(e){var t=e.img,n=e.difficulty,r=void 0===n?2:n,c=Object(b.a)(e,g),o=Object(i.useState)(t),a=Object(u.a)(o,2),s=a[0],l=s.width,f=s.height,d=a[1],v=Object(i.useMemo)((function(){var e=function(e,t,n){var i=Math.min(e,t)/n;return{numRows:t?Math.round(t/i):0,numCols:e?Math.round(e/i):0}}(l,f,r),n=e.numRows,i=e.numCols,c=l/i,o=f/n,a=t.width/i,u=t.height/n,s=.3*Math.min(c,o),j=.3*Math.min(a,u);return{img:t,difficulty:r,numRows:n,numCols:i,imgWidth:l,imgHeight:f,pieceWidth:c,pieceHeight:o,pieceWidthSrc:a,pieceHeightSrc:u,margin:s,marginSrc:j,setImageSize:d}}),[t,l,f,r]);return Object(h.jsx)(O.Provider,Object(j.a)({value:v},c))}function p(){var e=Object(i.useContext)(O);if(!e)throw new Error("`useConfig` must be called within `ConfigProvider`");return e}var m=n(30),x=n(8);function S(e,t,n,i){var r=e.top,c=e.left;return c<t.right&&c+n>t.left&&r+i>t.top&&r<t.bottom}function w(e,t,n,i){var r=Object.entries(e.slots).reduce((function(e,n){var i=Object(u.a)(n,2),r=i[0],c=i[1];return Object(j.a)(Object(j.a)({},e),{},Object(x.a)({},r,c===t?null:c))}),{}),c=e.stage.filter((function(e){return e!==t})).concat(t),o=Object(j.a)(Object(j.a)({},e.pieces),{},Object(x.a)({},t,Object(j.a)(Object(j.a)({},e.pieces[t]),{},{top:n,left:i})));return Object(j.a)(Object(j.a)({},e),{},{slots:r,stage:c,pieces:o})}function y(e,t){var n,i=Object(m.a)(t);try{for(i.s();!(n=i.n()).done;){e=w(e,n.value)}}catch(r){i.e(r)}finally{i.f()}return e}function C(e,t,n,i,r){var c=Object(j.a)(Object(j.a)({},e.pieces),e.stage.map((function(t){return e.pieces[t]})).reduce((function(e,c){return e[c.id]=Object(j.a)(Object(j.a)({},c),function(e){var t,n=e.stage,i=e.avoid,r=void 0===i?[]:i,c=e.pieceWidth,o=void 0===c?0:c,a=e.pieceHeight,s=void 0===a?0:a,l=0,f=Object(u.a)(r,1)[0];do{if(l++>500)throw new Error("timeout!");t={top:n.top+Math.random()*(n.bottom-n.top-s),left:n.left+Math.random()*(n.right-n.left-o)}}while(f&&S(t,f,o,s));return t}({stage:t,avoid:n,pieceWidth:i,pieceHeight:r})),e}),{}));return Object(j.a)(Object(j.a)({},e),{},{pieces:c})}function T(e,t){var n=e.slots[t];return n?e.pieces[n]:null}function z(e){return e.stage.map((function(t){return e.pieces[t]})).filter((function(e){var t=e.left,n=e.top;return void 0!==t&&void 0!==n}))}function P(e){return e.stage.map((function(t){return e.pieces[t]})).filter((function(e){var t=e.left,n=e.top;return void 0===t&&void 0===n}))}function H(e){for(var t=0,n=Object.entries(e.slots);t<n.length;t++){var i=Object(u.a)(n[t],2),r=i[0],c=i[1];if(!c||c!==r)return!1}return!0}var R=Object(i.createContext)(null);function E(e){var t=Object(i.useState)({slots:{},stage:[],pieces:{}}),n=Object(u.a)(t,2),r=n[0],c=n[1],o=Object(i.useMemo)((function(){return{isSolved:H(r),stagePieces:z(r),piecesToShuffle:P(r),getSlotPiece:function(e){return T(r,e)},movePieceToStage:function(e,t,n){return c((function(i){return w(i,e,t,n)}))},movePieceToSlot:function(e,t){return c((function(n){return function(e,t,n){var i=T(e,n);i&&(e=y(e,[i.id]));var r=Object.entries(e.slots).map((function(e){var i=Object(u.a)(e,2),r=i[0],c=i[1];return c===t?[r,null]:r===n?[r,t]:[r,c]})),c=Object(j.a)(Object(j.a)({},e.pieces),{},Object(x.a)({},t,Object(j.a)(Object(j.a)({},e.pieces[t]),{},{top:0,left:0})));return Object(j.a)(Object(j.a)({},e),{},{pieces:c,slots:Object.fromEntries(r),stage:e.stage.filter((function(e){return e!==t}))})}(n,e,t)}))},markPiecesToBeShuffled:function(e){return c((function(t){return y(t,e)}))},markAllPiecesToBeShuffled:function(){return c((function(e){return function(e){return y(e,Object.values(e.slots))}(e)}))},shufflePieces:function(e,t,n,i){return c((function(r){return C(r,e,t,n,i)}))},reset:function(e,t){return c(function(e,t){for(var n={},i={},r=0;r<e;r+=1)for(var c=0;c<t;c+=1){var o="".concat(c,"-").concat(r);n[o]={id:o,x:c,y:r,left:0,top:0},i[o]=o}return{slots:i,stage:[],pieces:n}}(e,t))},debug:function(){0}}}),[r]);return Object(h.jsx)(R.Provider,Object(j.a)({value:o},e))}function k(){var e=Object(i.useContext)(R);if(!e)throw new Error("`useGameState` must be called within `GameStateProvider`");return e}var W=n(51),M=n(5),I=M.a.div((function(e){return{display:"block",height:"100%",outline:e.isHighlighted?"3px solid rebeccapurple":"none"}}));function N(e){var t=e.x,n=e.y,i=k(),r=i.getSlotPiece,c=i.movePieceToSlot,o=function(e,t){return"".concat(e,"-").concat(t)}(t,n),a=r(o),s=Object(W.a)((function(){return{accept:"piece",collect:function(e){return{isOver:e.isOver()}},drop:function(e){var t;t=e.id,c(t,o)}}})),l=Object(u.a)(s,2),f=l[0].isOver,d=l[1];return Object(h.jsx)(I,{ref:d,isHighlighted:f,children:a?Object(h.jsx)(K,{piece:a}):null})}var D=M.a.div({display:"table",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),L=M.a.div({display:"table-row"}),B=M.a.div({display:"table-cell",position:"relative",border:"1px solid rgba(0, 0, 0, 0.4)",borderSpacing:0}),J=M.a.div({display:"inline-block",position:"relative",top:"50%",left:"50%",transform:"translate(-50%, -50%)"});function A(){var e=p(),t=e.numCols,n=e.numRows;return Object(h.jsx)(D,{children:d(n,(function(e){return Object(h.jsx)(L,{children:d(t,(function(t){return Object(h.jsx)(B,{children:Object(h.jsx)(N,{x:t,y:e})},t)}))},e)}))})}var F=n(52),G=n(26),Q=M.a.div({position:"absolute",maxWidth:"100%",maxHeight:"100%",":hover":{"z-index":"1"}}),U=M.a.div({position:"fixed","pointer-events":"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"}),V=M.a.canvas((function(e){var t=e.margin;return{"pointer-events":"none",transform:"translate(".concat(-t,"px, ").concat(-t,"px)")}}));function q(e){var t=e.piece,n=t.x,r=t.y,c=p(),o=c.margin,a=c.pieceWidth,u=c.pieceHeight,s=function(e){var t=e.x,n=e.y,r=Object(i.useRef)(null),c=p(),o=c.img,a=c.pieceWidth,u=c.pieceHeight,s=c.marginSrc,l=c.margin,f=c.pieceWidthSrc,d=c.pieceHeightSrc,j=c.numCols,b=c.numRows;return Object(i.useEffect)((function(){var e=r.current;if(e){var i=e.getContext("2d");i&&(i.clearRect(0,0,e.width,e.height),function(e,t){var n=t.margin,i=t.pieceWidth,r=t.pieceHeight,c=t.x,o=t.y,a=0===o,u=o===t.numRows-1,s=0===c,l=c===t.numCols-1;e.beginPath(),e.save(),e.translate(n,n),e.moveTo(0,0),a||(e.lineTo(.4*i,0),o%2?e.bezierCurveTo(.5*i-n,n,.5*i+n,n,.6*i,0):e.bezierCurveTo(.5*i-n,-n,.5*i+n,-n,.6*i,0)),e.lineTo(i,0),l||(e.lineTo(i,.4*r),c%2?e.bezierCurveTo(i+n,.5*r-n,i+n,.5*r+n,i,.6*r):e.bezierCurveTo(i-n,.5*r-n,i-n,.5*r+n,i,.6*r)),e.lineTo(i,r),u||(e.lineTo(.6*i,r),o%2?e.bezierCurveTo(.5*i+n,r-n,.5*i-n,r-n,.4*i,r):e.bezierCurveTo(.5*i+n,r+n,.5*i-n,r+n,.4*i,r)),e.lineTo(0,r),s||(e.lineTo(0,.6*r),c%2?e.bezierCurveTo(-n,.5*r+n,-n,.5*r-n,0,.4*r):e.bezierCurveTo(n,.5*r+n,n,.5*r-n,0,.4*r)),e.lineTo(0,0),e.strokeStyle="white",e.lineWidth=2,e.lineJoin="round",e.stroke(),e.restore()}(i,{margin:l,pieceWidth:a,pieceHeight:u,x:t,y:n,numRows:b,numCols:j}),i.save(),i.clip(),i.drawImage(o,t*f-s,n*d-s,f+2*s,d+2*s,0,0,a+2*l,u+2*l),i.restore())}}),[t,n,o,a,u,s,l,f,d,j,b]),r}({x:n,y:r});return Object(h.jsx)(V,{ref:s,width:a+2*o,height:u+2*o,margin:o})}function K(e){var t=e.piece,n=t.id,r=t.left,c=t.top,o=Object(F.a)({type:"piece",item:t,options:{dropEffect:"move"},collect:function(e){return{isDragging:e.isDragging()}}}),a=Object(u.a)(o,3),s=a[0].isDragging,l=a[1],f=a[2];return Object(i.useEffect)((function(){f(Object(G.a)(),{captureDraggingState:!0})}),[f]),Object(h.jsx)(Q,{ref:l,"data-testid":"piece-".concat(n),style:{top:"".concat(null!==c&&void 0!==c?c:0,"px"),left:"".concat(null!==r&&void 0!==r?r:0,"px"),cursor:"grab",opacity:s?0:1},children:Object(h.jsx)(q,{piece:t})})}var X=n(49);function Y(e){if(!e)return{display:"none"};var t=e.x,n=e.y,i="translate(".concat(t,"px, ").concat(n,"px)");return{transform:i,WebkitTransform:i}}function Z(){var e=Object(X.a)((function(e){return{item:e.getItem(),itemType:e.getItemType(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()}})),t=e.itemType,n=e.isDragging,i=e.item,r=e.currentOffset;return n&&"piece"===t?Object(h.jsx)(U,{children:Object(h.jsx)(Q,{style:Object(j.a)(Object(j.a)({},Y(r)),{},{cursor:"grabbing"}),children:Object(h.jsx)(q,{piece:i})})}):null}var $=M.a.img((function(e){var t=e.show,n=e.hint;return{maxWidth:"100%",maxHeight:"50vh",opacity:t?1:n?.2:0}}));function _(e){var t=e.show,n=void 0!==t&&t,r=e.hint,c=void 0!==r&&r,o=Object(i.useRef)(null),a=function(e){var t=Object(i.useState)([0,0]),n=Object(u.a)(t,2),r=n[0],c=n[1];return Object(i.useEffect)((function(){if(e){var t=new f.a((function(e){var t=e[0].contentRect;c([t.width,t.height])}));return t.observe(e),function(){return t.unobserve(e)}}}),[e]),r}(o.current),s=Object(u.a)(a,2),l=s[0],d=s[1],j=p(),b=j.img,g=j.setImageSize;return Object(i.useEffect)((function(){g({width:l,height:d})}),[l,d,g]),Object(h.jsx)($,{src:b.src,show:n,hint:c,ref:o})}var ee,te=n(35),ne=M.a.div(ee||(ee=Object(te.a)(["\n  boxShadow: ",",\n  margin-right: auto;\n  margin-left: auto;\n  padding: 15px 20px;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100vw;\n  height: 100vh;\n"])),(function(e){return e.isHighlighted?"0px 0px 16px green inset":"none"})),ie=Object(i.forwardRef)((function(e,t){var n=e.children,r=Object(i.useRef)(null),c=k(),o=c.movePieceToStage,a=c.stagePieces,s=Object(W.a)((function(){return{accept:"piece",collect:function(e){return{isOver:e.isOver()}},drop:function(e,t){if(!t.didDrop()){var n,i,r=t.getSourceClientOffset();o(e.id,null!==(n=null===r||void 0===r?void 0:r.y)&&void 0!==n?n:0,null!==(i=null===r||void 0===r?void 0:r.x)&&void 0!==i?i:0)}}}})),l=Object(u.a)(s,2),f=l[0].isOver,d=l[1];return Object(i.useEffect)((function(){d(r)})),Object(i.useImperativeHandle)(t,(function(){return r.current})),Object(h.jsxs)(ne,{isHighlighted:f,ref:r,children:[n,a.map((function(e){if(null!=e.top&&null!=e.left)return Object(h.jsx)(K,{piece:e},e.id)}))]})}));function re(){var e=Object(i.useState)(!1),t=Object(u.a)(e,1)[0],n=Object(i.useRef)(null),r=Object(i.useRef)(null),c=p(),o=c.numRows,a=c.numCols,s=c.pieceWidth,l=c.pieceHeight,f=k(),d=f.isSolved,j=f.piecesToShuffle,b=f.shufflePieces,g=f.reset;return Object(i.useEffect)((function(){var e,t;j.length&&n.current&&b(null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect().toJSON(),[null===(t=r.current)||void 0===t?void 0:t.getBoundingClientRect().toJSON()],s,l)}),[j,b,s,l]),Object(i.useEffect)((function(){g(o,a)}),[o,a]),Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("p",{style:{color:"white"},children:["Solved: ",d.toString()]}),Object(h.jsxs)(ie,{ref:n,children:[Object(h.jsxs)(J,{ref:r,children:[Object(h.jsx)(_,{hint:t}),Object(h.jsx)(A,{})]}),Object(h.jsx)(Z,{})]})]})}function ce(e){var t=e.imgSrc,n=e.difficulty,r=function(e){var t=Object(i.useState)({}),n=Object(u.a)(t,2),r=n[0],c=r.img,o=r.error,a=r.isLoading,s=n[1];return Object(i.useEffect)((function(){s((function(e){return Object(j.a)(Object(j.a)({},e),{},{error:void 0,isLoading:!0})}));var t=new Image;t.addEventListener("load",(function(){return s({img:t,error:void 0,isLoading:!1})})),t.addEventListener("error",(function(e){var t=e.message;return s((function(e){return Object(j.a)(Object(j.a)({},e),{},{error:t||"image could not be loaded :(",isLoading:!1})}))})),t.src=e}),[e]),{error:o,img:c,isLoading:a}}(t),c=r.error,o=r.img,a=r.isLoading;return c?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("h1",{children:"Error:"}),Object(h.jsx)("h2",{children:c})]}):a?Object(h.jsx)("h1",{children:"loading"}):o?Object(h.jsx)(s.a,{backend:l.a,children:Object(h.jsx)(v,{difficulty:n,img:o,children:Object(h.jsx)(E,{children:Object(h.jsx)(re,{})})})}):null}function oe(e){var t=e.onStart;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("header",{className:"page-header",children:Object(h.jsxs)("h1",{children:["So Puzzled!! ",Object(h.jsx)("br",{})," ","  ",Object(h.jsx)("small",{children:"A little puzzle game for practice, written in React and jQueryUI"})]})}),Object(h.jsxs)("main",{className:"jumbotron text-center",children:[Object(h.jsx)("h2",{children:"How to play:"}),Object(h.jsxs)("ol",{className:"text-left inline-block",children:[Object(h.jsxs)("li",{children:["Click the ",Object(h.jsx)("strong",{className:"",children:"Start"})," button"]}),Object(h.jsx)("li",{children:"Memorize the image"}),Object(h.jsx)("li",{children:"Piece the image back together"}),Object(h.jsx)("li",{children:".. profit?"})]}),Object(h.jsx)("p",{children:Object(h.jsx)("button",{type:"button",className:"btn btn-success btn-lg",onClick:t,children:"Start Puzzling"})})]})]})}ie.displayName="Stage";var ae=n.p+"static/media/kitty.9149cd00.jpg";function ue(){var e=Object(i.useState)(!0),t=Object(u.a)(e,2),n=t[0],r=t[1];return n?Object(h.jsx)(ce,{imgSrc:ae,difficulty:3}):Object(h.jsx)(oe,{onStart:function(){return r(!0)}})}console.log("Version: ".concat(a.a)),console.log("Build: ".concat("production")),o.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(ue,{})}),document.getElementById("app"))}},[[44,1,2]]]);
//# sourceMappingURL=main.eab7a207.chunk.js.map